<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>设置考题 - 网侦社后台管理系统</title>
  <link rel="stylesheet" type="text/css" href="Public/admin/CSS/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="Public/admin/CSS/style.css">
  <link rel="stylesheet" type="text/css" href="Public/admin/CSS/font-awesome.min.css">
  <link rel="apple-touch-icon-precomposed" href="Public/admin/images/icon/icon.png">
  <link rel="shortcut icon" href="Public/admin/images/icon/favicon.ico">
  <script src="Public/admin/JS/jquery-2.1.4.min.js"></script>
  <!--[if gte IE 9]>
  <script src="Public/admin/JS/jquery-1.11.1.min.js" type="text/javascript"></script>
  <script src="Public/admin/JS/html5shiv.min.js" type="text/javascript"></script>
  <script src="Public/admin/JS/respond.min.js" type="text/javascript"></script>
  <script src="Public/admin/JS/selectivizr-min.js" type="text/javascript"></script>
  <![endif]-->
<!--[if lt IE 9]>
  <script>window.location.href='upgrade-browser.html';</script>
<![endif]-->
</head>

<body class="user-select">
<section class="container-fluid">
  <header>
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"> <span class="sr-only">切换导航</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
          <a class="navbar-brand" href="?c=Index&a=main">AdcodeBlog</a> </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="index.php">回到首页 <span class="badge"></span></a></li>
            <li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><{$smarty.session.username}> <span class="caret"></span></a>
              <ul class="dropdown-menu dropdown-menu-left">
                <li><a href="?c=Index&a=personal">个人主页</a></li>
                <li><a title="查看您的登录记录" data-toggle="modal" data-target="#seeUserLoginlog">登录记录</a></li>
              </ul>
            </li>
            <li><a href="?c=Login&a=logout" onClick="if(!confirm('是否确认退出？'))return false;">退出登录</a></li>
            <li><a data-toggle="modal" data-target="#WeChat">帮助</a></li>
          </ul>
        </div>
      </div>
    </nav>
  </header>
  <div class="row">
    <aside class="col-sm-3 col-md-2 col-lg-2 sidebar">
      <ul class="nav nav-sidebar">
        <li><a href="?c=Index&a=main">报告</a></li>
      </ul>
      <ul class="nav nav-sidebar">
        <li><a href="?c=Index&a=article">文章</a></li>
        <li><a href="?c=Index&a=notice">公告</a></li>
        <li><a data-toggle="tooltip" data-placement="bottom" title="网站暂无评论功能">评论</a></li>
        <li><a data-toggle="tooltip" data-placement="bottom" title="网站暂无留言功能">留言</a></li>
      </ul>
      <ul class="nav nav-sidebar">
        <li><a href="?c=Index&a=category">栏目</a></li>
        <li><a class="dropdown-toggle" id="otherMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">其他</a>
          <ul class="dropdown-menu" aria-labelledby="otherMenu">
            <li><a href="?c=Index&a=flink">友情链接</a></li>
            <li><a data-toggle="modal" data-target="#areDeveloping">访问记录</a></li>
          </ul>
        </li>
      </ul>
      <ul class="nav nav-sidebar">
        <li><a class="dropdown-toggle" id="userMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">用户</a>
          <ul class="dropdown-menu" aria-labelledby="userMenu">
            <li><a href="?c=Index&a=user">管理用户</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="?c=Index&a=loginlog">管理登录日志</a></li>
          </ul>
        </li>
        <li><a href="?c=Index&a=Member">成员</a></li>
      </ul>
      <ul class="nav nav-sidebar">
        <li class="active"><a class="dropdown-toggle" id="raceMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">新生赛</a>
          <ul class="dropdown-menu" aria-labelledby="raceMenu">
            <li><a href="?c=Index&a=paper">考试设置</a></li>
            <li><a href="?c=Index&a=ques">题库设置</a></li>
          </ul>
        </li>
      </ul>
    </aside>
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-lg-10 col-md-offset-2 main" id="main">
      <h1 class="page-header">试卷:<{$paper.title}></h1>
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead>
          <tr> </tr>
          </thead>
          <tbody>
          <tr>
            <td>出题人:</td>
            <td><{$paper.author}></td>
            <td>考试时长:</td>
            <td><{$paper.deadline}> h</td>
          </tr>
          <tr>
            <td>总分:</td>
            <td><{$paper.maxScore}></td>
            <td>是否上线:</td>
            <td>
              <{if $paper.isDisplay}>
                <font color="#4682b4">已上线</font>
              <{else}>
                <font color="red">未上线</font>
              <{/if}>
            </td>

          </tr>
          <tr>
            <td>考试开始时间:</td>
            <td><{$paper.startTime|date_format:'%Y-%m-%d %H:%M:%S'}></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>考试须知:</td>
            <td colspan="3"><{$paper.notice}></td>
          </tr>
          </tbody>
          <tfoot>
          <tr></tr>
          </tfoot>
        </table>
      </div>

      <h1 class="page-header">管理考题</h1>

      <div class="clearfix col-md-6">
        <h2 class="page-header">已添加</h2>
        <form id="outForm" action="?c=Race&a=outPaperMul&paper_id=<{$paper.id}>" method="post">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
              <tr>
                <th><span class="glyphicon glyphicon-th-large"></span> <span class="visible-lg">选择</span></th>
                <th class="hidden-sm"><span class="glyphicon glyphicon-bookmark"></span> <span class="visible-lg">题型</span></th>
                <th><span class="glyphicon glyphicon-file"></span> <span class="visible-lg">题目描述</span></th>
                <th><span class="glyphicon glyphicon-pencil"></span> <span class="visible-lg">操作</span></th>
              </tr>
              </thead>


              <tbody>
              <{foreach $queses as $ques}>
                <tr>
                  <td><input type="checkbox" data-type="out" class="input-control" name="checkbox[]" value="<{$ques.id}>"/></td>
                  <td title="查看题目详情" data-toggle="modal" data-target="#ques" onclick="fetchQues(<{$ques.id}>)">
                    <{if $ques.type == 1}>
                      单选/判断
                    <{elseif $ques.type == 2}>
                      多选
                    <{elseif $ques.type == 3}>
                      填空
                    <{else}>
                      简答
                    <{/if}>
                  </td>
                  <td id="ques-content" class="article-title"><{$ques.content}></td>
                  <td>
                    <a href="?c=Race&a=outPaper&ques_id=<{$ques.id}>&paper_id=<{$paper.id}>"><span class="glyphicon glyphicon-minus" style="cursor: pointer">移除</span></a>
                  </td>
                </tr>
              <{/foreach}>
              </tbody>
            </table>
            <style>
              #ques-content, #ques-paper-title {
                max-width: 150px; /* 容器的宽度 */
                overflow: hidden; /* 设置溢出隐藏 */
                white-space: nowrap; /* 设置文本不换行 */
                text-overflow: ellipsis; /* 用省略号代替被截取掉的文本 */
              }
            </style>
          </div>

          <footer class="message_footer">
            <nav>
              <div class="btn-toolbar operation" role="toolbar">
                <div class="btn-group" role="group">
                  <a class="btn btn-default" onClick="mySelect('out')">全选</a>
                  <a class="btn btn-default" onClick="myReverse('out')">反选</a>
                  <a class="btn btn-default" onClick="myNoselect('out')">不选</a>
                </div>
                <div class="btn-group" role="group">
                  <button type="submit" class="btn btn-default" data-toggle="tooltip" data-placement="bottom" onclick="return confirm('您确定要将它们移除试卷吗？')" title="更新试题">全部移除</button>
                </div>
              </div>

            </nav>
          </footer>

        </form>
      </div>

      <div class="clearfix col-md-6">
        <h2 class="page-header">未添加</h2>
        <form id="inForm" action="?c=Race&a=inPaperMul&paper_id=<{$paper.id}>" method="post">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
              <tr>
                <th><span class="glyphicon glyphicon-th-large"></span> <span class="visible-lg">选择</span></th>
                <th class="hidden-sm"><span class="glyphicon glyphicon-bookmark"></span> <span class="visible-lg">题型</span></th>
                <th><span class="glyphicon glyphicon-file"></span> <span class="visible-lg">题目描述</span></th>
                <th><span class="glyphicon glyphicon-pencil"></span> <span class="visible-lg">操作</span></th>
              </tr>
              </thead>


              <tbody>
              <{foreach $quesesNotSelected as $ques}>
                <tr>
                  <td><input type="checkbox" data-type="in" class="input-control" name="checkbox[]" value="<{$ques.id}>"/></td>
                  <td title="查看题目详情" data-toggle="modal" data-target="#ques" onclick="fetchQues(<{$ques.id}>)">
                    <{if $ques.type == 1}>
                      单选/判断
                    <{elseif $ques.type == 2}>
                      多选
                    <{elseif $ques.type == 3}>
                      填空
                    <{else}>
                      简答
                    <{/if}>
                  </td>
                  <td id="ques-content" class="article-title"><{$ques.content}></td>
                  <td>
                    <a href="?c=Race&a=inPaper&ques_id=<{$ques.id}>&paper_id=<{$paper.id}>"><span class="glyphicon glyphicon-plus" style="cursor: pointer">添加</span></a>
                  </td>
                </tr>
              <{/foreach}>
              </tbody>
            </table>
            <style>
              #ques-content, #ques-paper-title {
                max-width: 150px; /* 容器的宽度 */
                overflow: hidden; /* 设置溢出隐藏 */
                white-space: nowrap; /* 设置文本不换行 */
                text-overflow: ellipsis; /* 用省略号代替被截取掉的文本 */
              }
            </style>
          </div>

          <footer class="message_footer">
            <nav>
              <div class="btn-toolbar operation" role="toolbar">
                <div class="btn-group" role="group">
                  <a class="btn btn-default" onClick="mySelect('in')">全选</a>
                  <a class="btn btn-default" onClick="myReverse('in')">反选</a>
                  <a class="btn btn-default" onClick="myNoselect('in')">不选</a>
                </div>
                <div class="btn-group" role="group">
                  <button type="submit" class="btn btn-default" data-toggle="tooltip" data-placement="bottom" onclick="return confirm('您确定要将他们全部添加入试卷吗？')" title="更新试题">全部添加</button>
                </div>
              </div>

            </nav>
          </footer>

        </form>
      </div>



    </div>
  </div>
</section>
<!--个人登录记录模态框-->
<div class="modal fade" id="seeUserLoginlog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" >登录记录</h4>
      </div>
      <div class="modal-body">
        <table class="table" style="margin-bottom:0;">
          <thead>
          <tr>
            <th>登录IP</th>
            <th>登录时间</th>
            <th>状态</th>
          </tr>
          </thead>
          <tbody>
          <{foreach $login_logs as $log}>
            <tr>
              <td><{$log.login_ip}></td>
              <td><{$log.login_time|date_format:'%Y-%m-%d %H:%M:%S'}></td>
              <td>成功</td>
            </tr>
          <{/foreach}>

          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">朕已阅</button>
      </div>
    </div>
  </div>
</div>
<!--微信二维码模态框-->
<div class="modal fade user-select" id="WeChat" tabindex="-1" role="dialog" aria-labelledby="WeChatModalLabel">
  <div class="modal-dialog" role="document" style="margin-top:120px;max-width:280px;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="WeChatModalLabel" style="cursor:default;">微信扫一扫</h4>
      </div>
      <div class="modal-body" style="text-align:center"> <img src="Public/admin/images/weixin.jpg" alt="" style="cursor:pointer"/> </div>
    </div>
  </div>
</div>
<!--提示模态框-->
<div class="modal fade user-select" id="areDeveloping" tabindex="-1" role="dialog" aria-labelledby="areDevelopingModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="areDevelopingModalLabel" style="cursor:default;">该功能正在日以继夜的开发中…</h4>
      </div>
      <div class="modal-body"> <img src="Public/admin/images/baoman/baoman_01.gif" alt="深思熟虑" />
        <p style="padding:15px 15px 15px 100px; position:absolute; top:15px; cursor:default;">很抱歉，程序猿正在日以继夜的开发此功能，本程序将会在以后的版本中持续完善！</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">朕已阅</button>
      </div>
    </div>
  </div>
</div>
<!--题目模态框-->
<div class="modal fade" id="ques" tabindex="-1" role="dialog" aria-labelledby="quesLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" >题目</h4>
      </div>
      <div class="modal-body">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">朕已阅</button>
      </div>
    </div>
  </div>
</div>
<script src="Public/admin/JS/bootstrap.min.js"></script>
<script src="Public/admin/JS/admin-scripts.js"></script>
<script>
  function mySelect(type) {
    $("input[type='checkbox'][data-type='" + type + "']").prop("checked", true);
  }
  function myReverse(type) {
    $("input[type='checkbox'][data-type='" + type + "']").prop("checked", function(index, val) {
      return !val;
    });

  }
  function myNoselect(type) {
    $("input[type='checkbox'][data-type='" + type + "']").prop("checked", false);
  }

  function fetchQues(id) {
    $.post(
            "?c=Race&a=returnQues",
            {
              id: id
            },
            function (data) {
              data = JSON.parse(data);
              console.log(data);
              let quesDiv = $("#ques .modal-body")
              quesDiv.empty();

              if(data.type === '1' || data.type === '2') {//填空/判断 或 多选
                let content = "<p class='add-article-box-title'>" + data.content + "(" + data.score + ")" + "</p>";
                quesDiv.append(content);

                let ans = data.answer.split("*");
                let answer = "<ul>";
                for(let i = 0; i < ans.length; i++) {
                  answer += ("<li style='padding: 5px;margin-left: 10px'>"+ ans[i] +"</li>");
                }
                answer += "</ul>";
                quesDiv.append(answer);

                let correctAnswer;
                if (data.type === '1')
                  correctAnswer = "<p style='padding: 10px 5px'>正确答案：<font color='red'>" + data.correctAnswer + "</font></p>";
                else
                  correctAnswer = "<p style='padding: 10px 5px'>正确答案：<font color='red'>" + data.correctAnswer.split("*").join("或") + "</font></p>";
                quesDiv.append(correctAnswer);

                let analysis = "<p style='padding: 10px 5px'>答案解析：" + data.analysis + "</p>"
                quesDiv.append(analysis);
              }
              else if(data.type === '3' || data.type === '4') { //填空题 简答题
                let content = "<p class='add-article-box-title'>" + data.content + "(" + data.score + ")" + "</p>";
                quesDiv.append(content);

                let correctAnswer = "<p style='padding: 10px 5px'>正确答案：<font color='red'>" + data.correctAnswer + "</font></p>";
                quesDiv.append(correctAnswer);

                let analysis = "<p style='padding: 10px 5px'>答案解析：" + data.analysis + "</p>"
                quesDiv.append(analysis);

              }

            }
    )
  }

</script>
</body>
</html>
